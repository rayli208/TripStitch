rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // Music tracks (public read, no client writes)
    match /music/{allPaths=**} {
      allow read: if true;
    }

    // User logo uploads — only the owner can write, anyone can read
    match /users/{userId}/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Trip cover images — public read, only authenticated users can write
    // (owner check isn't possible at storage level without custom claims,
    //  but the path includes tripId which limits blast radius)
    match /trips/{tripId}/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
}
